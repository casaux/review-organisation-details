(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{PcYx:function(e,t,i){"use strict";i.r(t),i.d(t,"ChooseIdpModule",(function(){return $}));var r=i("2kYt"),n=i("D/wg"),c=i("47kq"),s=i("NNuM"),a=i("Pq5H"),o=i("sEIs"),d=i("pJFc"),p=i("42YS"),h=i("XZLj"),u=i("lwwr"),l=i("ke9K"),b=i("q6bj"),v=i("lu7F"),y=i("VFro"),g=i("EM62"),f=i("qFEQ"),m=i("tQqY"),S=i("UChC");function I(e,t){if(1&e){const e=g.Wb();g.Vb(0,"div"),g.Vb(1,"a",6),g.dc("click",(function(){return g.xc(e),g.hc().onBack()})),g.Qb(2,"fa-icon",7),g.Gc(3," Back "),g.Ub(),g.Ub()}if(2&e){const e=g.hc();g.Cb(2),g.mc("icon",e.faAngleLeft)}}let P=(()=>{class e{constructor(e,t,i,r,n,c,s,a,o,d,p){this.pageTitleService=e,this.redirectService=t,this.backService=i,this.rpStateQuery=r,this.idpStateQuery=n,this.flowStateService=c,this.flowStateQuery=s,this.cancelNavigation=a,this.helpService=o,this.flowService=d,this.auditService=p,this.faAngleLeft=v.a,this.title="Select your identity provider"}ngOnInit(){this.redirectService.setRedirecting(!1),this.pageTitleService.setTitle(this.title),this.flowStateService.updateIdp("selection",d.k.InProgress),this.identityProviders$=this.idpStateQuery.providers$,this.rpName=this.rpStateQuery.info.properties.displayName,this.backService.setBackLocation("/choose-identity-provider/selection"),this.isConnector=this.flowStateQuery.isInIntegrationFlow}ngOnDestroy(){}canDeactivate(){return!!this.idpStateQuery.hasActive()}cancel(){this.auditService.audit("idp_selection").subscribe(e=>{},e=>console.error("Audit error",e),()=>{this.cancelNavigation.resolveNavigation(b.a.ChooseIdentityProvider,d.d.AuthenticationCancelled)})}openHelp(e){this.helpService.emitOpenHelp(e)}onBack(){this.flowService.updateIdp("selection",d.k.Required)}}return e.\u0275fac=function(t){return new(t||e)(g.Pb(h.c),g.Pb(u.RedirectService),g.Pb(h.a),g.Pb(l.k),g.Pb(l.g),g.Pb(b.f),g.Pb(b.i),g.Pb(b.c),g.Pb(s.b),g.Pb(b.f),g.Pb(y.a))},e.\u0275cmp=g.Jb({type:e,selectors:[["app-choose-idp"]],decls:15,vars:6,consts:[["fxLayout","column"],[4,"ngIf"],["link","","data-auto","choose-idp-what-is-idp-link",3,"click"],[1,"cdk-visually-hidden"],[3,"idps"],["link","","data-auto","choose-idp-cancel-button",3,"click"],["link","","routerLink","/connector/connect-idp",3,"click"],[3,"icon"]],template:function(e,t){1&e&&(g.Vb(0,"div",0),g.Ec(1,I,4,1,"div",1),g.Vb(2,"h1"),g.Gc(3),g.Ub(),g.Vb(4,"p"),g.Gc(5),g.Ub(),g.Vb(6,"span"),g.Vb(7,"a",2),g.dc("click",(function(){return t.openHelp("provider")})),g.Gc(8," What is an identity provider? "),g.Vb(9,"span",3),g.Gc(10," opens in help page "),g.Ub(),g.Ub(),g.Ub(),g.Qb(11,"exchange-idp-details",4),g.ic(12,"async"),g.Ub(),g.Vb(13,"a",5),g.dc("click",(function(){return t.cancel()})),g.Gc(14,"Cancel"),g.Ub()),2&e&&(g.Cb(1),g.mc("ngIf",t.isConnector),g.Cb(2),g.Hc(t.title),g.Cb(2),g.Ic("",t.rpName," needs you to prove who you are using a Digital Identity."),g.Cb(6),g.mc("idps",g.jc(12,4,t.identityProviders$)))},directives:[f.b,r.k,m.a,S.a,o.f,a.a],pipes:[r.b],styles:[""]}),e})();var Q=i("cJ9h"),k=i("5uDM"),w=i("8lHc"),A=i("81ol"),N=i("vIZi"),R=i("AytR"),x=i("xoJQ"),j=i("j51s");let C=(()=>{class e{constructor(e,t,i,r,n,c,s,a,o,d){this.document=e,this.idpStateQuery=t,this.idpStateService=i,this.rpStateQuery=r,this.configStateQuery=n,this.flowService=c,this.exchangeApi=s,this.externalApi=a,this.router=o,this.timeoutService=d}ngOnInit(){console.debug("starting login to IDP"),this.idpStateQuery.getActive()||this.router.navigate(["/error"]),this.flowService.updateIdp("login",d.k.InProgress),this.timeoutService.setActivityActivation(!1),this.timeoutService.deactivateActivityTimeouts(),this.idpStateService.createAuthId(),this.idpName=this.populateName(),this.loginToIdentityProvider().subscribe(e=>{e&&this.externalRedirect(e.location)})}populateName(){const e=this.idpStateQuery.getActive();return e&&e.properties&&e.properties.displayName?e.properties.displayName:null}externalRedirect(e){Object(w.a)(this.configStateQuery.redirectTimeout).subscribe(()=>{R.a.production||(console.warn("Redirecting via JSON object"),this.document.location.href=e)})}loginToIdentityProvider(){return console.debug(`idpAuthId: ${this.idpStateQuery.authId}`),console.debug(`rpAuthId: ${this.rpStateQuery.authId}`),console.debug(`idpId: ${this.idpStateQuery.idpId}`),Object(w.a)(this.configStateQuery.redirectTimeout).pipe(Object(Q.a)(()=>this.initiateIdpAuthRequest(this.idpStateQuery.authId,this.rpStateQuery.authId,this.idpStateQuery.idpId)),Object(k.a)(()=>this.processAuthRequest(this.idpStateQuery.authId)),Object(k.a)(e=>this.stepThree(e.fullURL)))}initiateIdpAuthRequest(e,t,i){return console.debug(`idpAuthId: ${e}, rpAuthId: ${t}, idpId: ${i}`),this.exchangeApi.authenticateIdpSelection({id:e,rpAuthId:t,idpId:i})}processAuthRequest(e){return this.exchangeApi.confirmIdpSelectionAuthentication(e)}stepThree(e){return this.externalApi.getRelyingPartyRedirectLocation(new URL(e))}}return e.\u0275fac=function(t){return new(t||e)(g.Pb(r.d),g.Pb(l.g),g.Pb(l.h),g.Pb(l.k),g.Pb(A.b),g.Pb(b.f),g.Pb(N.a),g.Pb(N.b),g.Pb(o.e),g.Pb(x.c))},e.\u0275cmp=g.Jb({type:e,selectors:[["exchange-login-to-idp"]],decls:1,vars:1,consts:[[3,"name"]],template:function(e,t){1&e&&g.Qb(0,"app-generic-redirect",0),2&e&&g.mc("name",t.idpName)},directives:[j.a],styles:[""]}),e})(),O=(()=>{class e{constructor(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=g.Jb({type:e,selectors:[["exchange-choose-idp-shell"]],decls:1,vars:0,template:function(e,t){1&e&&g.Qb(0,"app-generic-redirect")},directives:[j.a],styles:[""]}),e})();var U=i("XzLU");let L=(()=>{class e{constructor(e,t,i,r){this.route=e,this.config=t,this.rpQuery=i,this.title=r,this.redirectName=this.rpQuery.displayName,this.route.queryParams.subscribe(e=>{this.title.setTitle(`Returning to ${this.redirectName}`),this.externalRedirect(this.generateCancelUrl(e.context).href)})}externalRedirect(e){Object(w.a)(this.config.redirectTimeout).subscribe(()=>{Object(U.k)(),window.location.href=e})}generateCancelUrl(e){const t=new URL(this.rpQuery.redirectUri);return t.searchParams.append("error",e),t.searchParams.append("state",this.rpQuery.state),t}}return e.\u0275fac=function(t){return new(t||e)(g.Pb(o.a),g.Pb(A.b),g.Pb(l.k),g.Pb(h.c))},e.\u0275cmp=g.Jb({type:e,selectors:[["exchange-choose-idp-cancel"]],decls:1,vars:1,consts:[[3,"name"]],template:function(e,t){1&e&&g.Qb(0,"app-generic-redirect",0),2&e&&g.mc("name",t.redirectName)},directives:[j.a],styles:[""]}),e})();var T=i("8j5Y"),q=i("ROBh"),J=i("vobO");const M=[{path:"",component:O,resolve:{idp:(()=>{class e{constructor(e,t,i,r,n){this.idpNavigation=e,this.rpQuery=t,this.idpQuery=i,this.idpService=r,this.exchangeApi=n}resolve(){return console.debug("inside choose idp entry resolver"),this.getIdpInformation().pipe(Object(T.a)(()=>{this.navigate(b.a.ChooseIdentityProvider)}))}getIdpInformation(){var e,t;if(this.idpQuery.getCount()>=1)return console.debug("we already have some IDPs"),Object(q.a)([]);console.debug("we have no idps, need to make a call");let i=new J.e;return(null===(e=this.rpQuery.response)||void 0===e?void 0:e.minRanking)&&(i=i.set("minimumRanking",this.rpQuery.response.minRanking.toString())),(null===(t=this.rpQuery.response)||void 0===t?void 0:t.loaType)&&(i=i.set("type",this.rpQuery.response.loaType)),this.exchangeApi.getListOfIdentityProviders(this.rpQuery.response.id,i).pipe(Object(T.a)(e=>{this.idpService.addIdentityProviderList(e)}))}navigate(e){this.idpNavigation.resolveNavigation(e)}}return e.\u0275fac=function(t){return new(t||e)(g.Zb(b.j),g.Zb(l.k),g.Zb(l.g),g.Zb(l.h),g.Zb(N.a))},e.\u0275prov=g.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},pathMatch:"full"},{path:"selection",component:P,canActivate:[p.e],data:{flow:"IdentityProviderSelection",allowedEntryStates:[d.k.Required,d.k.InProgress],allowedExitStates:[d.k.Completed]},pathMatch:"full"},{path:"login",component:C,canActivate:[p.e],pathMatch:"full"},{path:"cancel",component:L,pathMatch:"full"}];let V=(()=>{class e{}return e.\u0275mod=g.Nb({type:e}),e.\u0275inj=g.Mb({factory:function(t){return new(t||e)},imports:[[o.g.forChild(M)],o.g]}),e})(),$=(()=>{class e{}return e.\u0275mod=g.Nb({type:e}),e.\u0275inj=g.Mb({factory:function(t){return new(t||e)},providers:[],imports:[[r.c,a.b,c.a,n.a,V,s.a]]}),e})()}}]);