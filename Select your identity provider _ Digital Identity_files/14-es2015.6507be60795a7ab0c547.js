(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"8KXm":function(t,e,i){"use strict";i.r(e),i.d(e,"ConsentLinkableRelyingPartyModule",(function(){return K}));var n=i("D/wg"),a=i("47kq"),o=i("sEIs"),c=i("42YS"),s=i("ke9K"),r=i("vobO"),l=i("8j5Y"),b=i("q6bj"),u=i("vIZi"),h=i("pJFc"),m=i("EM62");let d=(()=>{class t{constructor(t,e,i,n,a,o){this.rpQuery=t,this.linkRpQuery=e,this.claim=i,this.idpQuery=n,this.navigation=a,this.integrationApi=o}resolve(){return this.initiateLinkableUserConsentFlow()}initiateLinkableUserConsentFlow(){return this.getUserInfo().pipe(Object(l.a)(()=>{this.navigate(b.a.InitiateLinkableConsent)}))}getUserInfo(){let t;t=this.linkRpQuery.connectorType==h.e.Create?"false":"true";const e=(new r.e).set("isLinkConsent",t);return this.integrationApi.retrieveLinkableUserClaims(this.rpQuery.authId,this.idpQuery.authId,e).pipe(Object(l.a)(t=>{const{claims:e,documentClaims:i}=t;this.claim.updateLinkableClaims(e),this.claim.updateLinkableDocuments(i)}))}navigate(t){this.navigation.resolveNavigation(t)}}return t.\u0275fac=function(e){return new(e||t)(m.Zb(s.k),m.Zb(s.i),m.Zb(s.d),m.Zb(s.g),m.Zb(b.n),m.Zb(u.c))},t.\u0275prov=m.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var p=i("j51s");let g=(()=>{class t{constructor(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=m.Jb({type:t,selectors:[["exchange-linkable-consent-shell"]],decls:1,vars:0,template:function(t,e){1&t&&m.Qb(0,"app-generic-redirect")},directives:[p.a],styles:[""]}),t})();var f=i("lu7F"),y=i("XZLj"),v=i("lwwr"),C=i("xoJQ"),k=i("NNuM"),w=i("81ol"),I=i("HM3f"),S=i("fN3Q"),Q=i("OZ4H"),P=i("sg/T"),x=i("bFHC"),U=i("Meci"),N=i("PBFl");let O=(()=>{class t{constructor(t,e){this.thisDialogRef=t,this.data=e}ngOnInit(){}continueOnModal(){this.thisDialogRef.close("Continue")}}return t.\u0275fac=function(e){return new(e||t)(m.Pb(Q.e),m.Pb(Q.a))},t.\u0275cmp=m.Jb({type:t,selectors:[["app-consent-modal"]],decls:10,vars:1,consts:[["role","alertdialog","cdkTrapFocus","",1,"modal-body"],["svgIcon","green-tick",1,"green-tick"],[1,"message-display"],["role","presentation","src","/assets/img/mygov-logo.svg","alt","",1,"img-top-margin-and-height"],[1,"message-font"],["data-auto","consent-modal-continue-button","mat-raised-button","","color","primary",1,"buttonsize",3,"click"]],template:function(t,e){1&t&&(m.Vb(0,"div",0),m.Qb(1,"mat-icon",1),m.Vb(2,"mat-dialog-content"),m.Vb(3,"div",2),m.Qb(4,"img",3),m.Vb(5,"div",4),m.Gc(6),m.Ub(),m.Ub(),m.Ub(),m.Vb(7,"mat-card-actions"),m.Vb(8,"button",5),m.dc("click",(function(){return e.continueOnModal()})),m.Gc(9," Continue "),m.Ub(),m.Ub(),m.Ub()),2&t&&(m.Cb(6),m.Hc(e.data))},directives:[P.e,x.a,Q.c,U.b,N.a],styles:[".modal-body[_ngcontent-%COMP%]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;position:relative;flex:1 1 auto;padding:9px!important;max-width:400px}.green-tick[_ngcontent-%COMP%]{display:block;margin:27px auto;width:100px;height:100px}.mat-dialog-content[_ngcontent-%COMP%]{max-height:100%!important}.mat-dialog-content[_ngcontent-%COMP%]   .message-font[_ngcontent-%COMP%]{margin-left:15px;font-size:20px;font-weight:400;line-height:1.5;margin-bottom:25px}.mat-dialog-content[_ngcontent-%COMP%]   .message-display[_ngcontent-%COMP%]{margin-top:27px;display:flex}.mat-dialog-content[_ngcontent-%COMP%]   .img-top-margin-and-height[_ngcontent-%COMP%]{margin-top:8px;height:50px}.mat-card-actions[_ngcontent-%COMP%]{margin-left:0;margin-right:0;padding:0}.mat-card-actions[_ngcontent-%COMP%]   .buttonsize[_ngcontent-%COMP%]{width:100%;border-radius:4px;margin-bottom:0}"]}),t})(),T=(()=>{class t{constructor(t,e,i){this.dialog=t,this.linkQuery=e,this.navigation=i}openDialog(){const t=this.getDialog(this.linkQuery.connectorType);this.dialog.open(O,{data:t,hasBackdrop:!0,disableClose:!0,panelClass:"custom-dialog-container"}).afterClosed().subscribe(t=>{t&&this.initiateNavigation()})}initiateNavigation(){this.navigation.resolveNavigation(b.a.ProvideLinkableConsent)}getDialog(t){switch(t.toLowerCase()){case"connect":return`Your ${this.linkQuery.displayName} account is now connected to your Digital Identity.`;case"create":return`You've created a ${this.linkQuery.displayName} account. You can sign in to ${this.linkQuery.displayName} using your Digital Identity.`;default:case"share":return`We've shared these identity details with ${this.linkQuery.displayName}.`}}}return t.\u0275fac=function(e){return new(e||t)(m.Zb(Q.b),m.Zb(s.i),m.Zb(b.o))},t.\u0275prov=m.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),L=(()=>{class t{constructor(t,e,i,n,a,o,c){this.modal=t,this.rpQuery=e,this.idpQuery=i,this.linkQuery=n,this.flowService=a,this.integrationApi=o,this.linkService=c}initateConsent(){return this.submit().pipe(Object(l.a)(t=>{this.allowedHttpStatus(t.status)&&(this.flowService.updateIntegration("consent",h.k.Completed),this.modal.openDialog())}))}allowedHttpStatus(t){switch(t){case 200:case 201:case 204:return!0;default:return!1}}submit(){return this.linkService.updateLinkableRPAuthId(Object(S.v4)()),this.integrationApi.provideLinkableConsent(this.linkQuery.rpAuthId,{idpAuthId:this.idpQuery.authId,rpAuthId:this.rpQuery.authId,triggerScope:"mygov_linked",linkIdpAuthId:this.linkQuery.authId})}}return t.\u0275fac=function(e){return new(e||t)(m.Zb(T),m.Zb(s.k),m.Zb(s.g),m.Zb(s.i),m.Zb(b.f),m.Zb(u.c),m.Zb(s.j))},t.\u0275prov=m.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=i("2kYt"),V=i("/Epb"),D=i("tQqY"),j=i("Ptrw"),A=i("Pq5H"),Z=i("qFEQ"),R=i("A/CR");function _(t,e){if(1&t&&(m.Vb(0,"div"),m.Qb(1,"fa-icon",12),m.Vb(2,"a",13),m.Gc(3," Back"),m.Ub(),m.Ub()),2&t){const t=m.hc();m.Cb(1),m.mc("icon",t.faAngleLeft)}}function E(t,e){if(1&t&&(m.Vb(0,"mat-card",14),m.Qb(1,"mat-icon",15),m.Vb(2,"span"),m.Gc(3),m.Ub(),m.Ub()),2&t){const t=m.hc();m.Cb(3),m.Ic("You've signed into ",t.linkableName,"")}}function G(t,e){if(1&t&&(m.Vb(0,"h1",16),m.Gc(1),m.Ub()),2&t){const t=m.hc();m.Cb(1),m.Ic("Create and connect your ",t.linkableName," account")}}function H(t,e){if(1&t&&(m.Vb(0,"h1",16),m.Gc(1),m.Ub()),2&t){const t=m.hc();m.Cb(1),m.Ic("Connect your Digital Identity to your ",t.linkableName," account")}}function F(t,e){if(1&t&&(m.Vb(0,"h1",16),m.Gc(1),m.Ub()),2&t){const t=m.hc();m.Cb(1),m.Ic("Share your details with ",t.linkableName,"")}}function J(t,e){if(1&t&&(m.Tb(0),m.Vb(1,"p"),m.Gc(2),m.Ub(),m.Sb()),2&t){const t=m.hc();m.Cb(2),m.Ic("We'll use these details to connect your Digital Identity to your ",t.linkableName," account.")}}function Y(t,e){if(1&t&&(m.Tb(0),m.Gc(1," We'll use these details to: "),m.Vb(2,"ul",17),m.Vb(3,"li"),m.Gc(4),m.Ub(),m.Vb(5,"li"),m.Gc(6),m.Ub(),m.Ub(),m.Sb()),2&t){const t=m.hc();m.Cb(4),m.Ic("create your ",t.linkableName," account"),m.Cb(2),m.Ic("connect your Digital Identity to your ",t.linkableName," account.")}}function W(t,e){if(1&t&&m.Qb(0,"exchange-claim-container",18),2&t){const t=m.hc();m.mc("claims",t.allClaims.claims)("documentClaims",t.allClaims.documentClaims)}}let q=(()=>{class t{constructor(t,e,i,n,a,o,c,s,r,l,b,u){this.claimQuery=t,this.redirect=e,this.flowService=i,this.submit=n,this.linkableRpQuery=a,this.idpQuery=o,this.config=c,this.backService=s,this.timeoutStateService=r,this.timeoutQuery=l,this.helpService=b,this.pageTitleService=u,this.faAngleLeft=f.a,this.cancelContext=h.d.AuthenticationCancelled}ngOnInit(){this.startSensitiveTimer(),this.backService.setBackLocation(b.a.ProvideLinkableConsent),this.flowService.updateIntegration("consent",h.k.InProgress),this.redirect.setRedirecting(!1),this.allClaims=Object.assign({},this.claimQuery.allLinkableClaims),this.flow=this.linkableRpQuery.connectorType.toLowerCase(),this.linkableName=this.linkableRpQuery.displayName,this.selectedIdp=this.idpQuery.selectedIdentityProvider,this.idpLogoUrl=this.selectedIdp.properties.logoUrl,this.idpName=this.selectedIdp.properties.displayName,"connect"==this.flow?this.pageTitleService.setTitle("Connect your Digital Identity to your "+this.linkableName+" account"):"create"==this.flow?this.pageTitleService.setTitle("Create and connect your "+this.linkableName+" account"):"share"==this.flow&&this.pageTitleService.setTitle("Share your details with "+this.linkableName)}startSensitiveTimer(){Object(I.a)([this.timeoutQuery.activityExpiry,this.timeoutQuery.activityWarning]).subscribe(([t,e])=>{if(t&&e){this.timeoutQuery.activityTimeoutIsActivated||(this.timeoutStateService.startActivityTimer(t),this.timeoutStateService.startActivityWarningTimer(e));const i=new Date(Date.now()+this.config.sensitiveIdleTimeoutInMilliseconds),n=new Date(Date.now()+this.config.sensitiveIdleWarningInMilliseconds);n.getTime()>new Date(e).getTime()&&i.getTime()>new Date(t).getTime()||(this.timeoutStateService.startSensitiveTimer(i),this.timeoutStateService.startSensitiveWarningTimer(n))}})}submitConsent(t){t&&this.submit.initateConsent().subscribe(()=>{})}ngOnDestroy(){this.timeoutStateService.resetSensitiveTimeouts()}openHelp(t){this.helpService.emitOpenHelp(t)}}return t.\u0275fac=function(e){return new(e||t)(m.Pb(s.c),m.Pb(v.RedirectService),m.Pb(b.f),m.Pb(L),m.Pb(s.i),m.Pb(s.g),m.Pb(w.b),m.Pb(y.a),m.Pb(C.c),m.Pb(C.b),m.Pb(k.b),m.Pb(y.c))},t.\u0275cmp=m.Jb({type:t,selectors:[["exchange-linkable-give-consent"]],decls:26,vars:14,consts:[[4,"ngIf"],["class","attention-bar","fxLayout","","role","status",4,"ngIf"],[3,"ngSwitch"],["class","title",4,"ngSwitchCase"],["ng-class","flow == 'connect' ? 'addbottom-margin' : 'no-bottom-margin'"],[1,"move-left","two",2,"margin-top","16px"],[3,"idpLogoUrl","idpName"],[3,"claims","documentClaims",4,"ngIf"],[2,"margin-top","48px"],["link","",3,"click"],[1,"addbottom-margin"],[3,"consentContext","cancelContext","beginSubmission"],[3,"icon"],["link","","routerLink","/connector/connect-mygov"],["fxLayout","","role","status",1,"attention-bar"],["svgIcon","green-tick"],[1,"title"],[1,"no-top-margin"],[3,"claims","documentClaims"]],template:function(t,e){1&t&&(m.Ec(0,_,4,1,"div",0),m.Ec(1,E,4,1,"mat-card",1),m.Tb(2,2),m.Ec(3,G,2,1,"h1",3),m.Ec(4,H,2,1,"h1",3),m.Ec(5,F,2,1,"h1",3),m.Sb(),m.Tb(6),m.Vb(7,"div"),m.Qb(8,"p",4),m.Tb(9),m.Vb(10,"p"),m.Gc(11),m.Ub(),m.Sb(),m.Ec(12,J,3,1,"ng-container",0),m.Ec(13,Y,7,2,"ng-container",0),m.Ub(),m.Vb(14,"div",5),m.Qb(15,"exchange-consent-idp-info",6),m.Ec(16,W,1,2,"exchange-claim-container",7),m.Vb(17,"p",8),m.Gc(18," Find out more about "),m.Vb(19,"a",9),m.dc("click",(function(){return e.openHelp("consent")})),m.Gc(20," giving consent "),m.Ub(),m.Ub(),m.Vb(21,"p",10),m.Gc(22," By giving consent, you agree to our "),m.Vb(23,"a",9),m.dc("click",(function(){return e.openHelp("privacy")})),m.Gc(24,"privacy policy"),m.Ub(),m.Ub(),m.Vb(25,"app-buttons-new",11),m.dc("beginSubmission",(function(t){return e.submitConsent(t)})),m.Ub(),m.Ub(),m.Sb()),2&t&&(m.mc("ngIf","connect"!=e.flow),m.Cb(1),m.mc("ngIf",e.flow&&"connect"==e.flow),m.Cb(1),m.mc("ngSwitch",e.flow),m.Cb(1),m.mc("ngSwitchCase","create"),m.Cb(1),m.mc("ngSwitchCase","connect"),m.Cb(1),m.mc("ngSwitchCase","share"),m.Cb(6),m.Ic("If you give consent, we'll share these details with ",e.linkableName,"."),m.Cb(1),m.mc("ngIf","connect"==e.flow),m.Cb(1),m.mc("ngIf","create"==e.flow),m.Cb(2),m.mc("idpLogoUrl",e.idpLogoUrl)("idpName",e.idpName),m.Cb(1),m.mc("ngIf",e.allClaims.claims||e.allClaims.documentClaims),m.Cb(9),m.mc("consentContext","integration")("cancelContext",e.cancelContext))},directives:[M.k,M.m,M.n,V.a,D.a,j.a,A.a,o.f,U.a,Z.b,x.a,R.a],styles:[".attention-bar[_ngcontent-%COMP%]{padding:12px;background-color:#fff;border:2px solid #026540;margin-bottom:1.5rem;align-items:left;justify-content:left;font-size:18px;box-shadow:none!important}.attention-bar[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:10px}.inline-mat-icon[_ngcontent-%COMP%]{vertical-align:text-bottom}"]}),t})();var B=i("8lHc"),z=i("XzLU");const $=[{path:"",component:g,resolve:{entry:d},pathMatch:"full"},{path:"submit",component:q,canActivate:[c.e],pathMatch:"full"},{path:"cancel",component:(()=>{class t{constructor(t,e,i,n){this.route=t,this.config=e,this.rpQuery=i,this.title=n,this.redirectName=this.rpQuery.displayName,this.route.queryParams.subscribe(t=>{this.title.setTitle(`Returning to ${this.redirectName}`),this.externalRedirect(this.generateCancelUrl(t.context).href)})}externalRedirect(t){Object(B.a)(this.config.redirectTimeout).subscribe(()=>{Object(z.k)({exclude:["persisted authorisation"]}),window.location.href=t})}generateCancelUrl(t){const e=new URL(this.rpQuery.redirectUri);return e.searchParams.append("error",t),e.searchParams.append("state",this.rpQuery.state),e}}return t.\u0275fac=function(e){return new(e||t)(m.Pb(o.a),m.Pb(w.b),m.Pb(s.k),m.Pb(y.c))},t.\u0275cmp=m.Jb({type:t,selectors:[["exchange-linkable-consent-cancel"]],decls:1,vars:1,consts:[[3,"name"]],template:function(t,e){1&t&&m.Qb(0,"app-generic-redirect",0),2&t&&m.mc("name",e.redirectName)},directives:[p.a],styles:[""]}),t})(),pathMatch:"full"}];let X=(()=>{class t{}return t.\u0275mod=m.Nb({type:t}),t.\u0275inj=m.Mb({factory:function(e){return new(e||t)},imports:[[o.g.forChild($)],o.g]}),t})(),K=(()=>{class t{}return t.\u0275mod=m.Nb({type:t,bootstrap:[O]}),t.\u0275inj=m.Mb({factory:function(e){return new(e||t)},providers:[d,T,L],imports:[[a.a,n.a,X]]}),t})()}}]);