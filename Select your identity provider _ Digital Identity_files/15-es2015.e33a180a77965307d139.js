(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"5rwE":function(e,t,i){"use strict";i.r(t),i.d(t,"ConsentRelyingPartyModule",(function(){return te}));var n=i("D/wg"),s=i("47kq"),c=i("sEIs"),a=i("42YS"),r=i("EM62"),o=i("j51s");let l=(()=>{class e{constructor(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Jb({type:e,selectors:[["exchange-consent-relying-party-shell"]],decls:1,vars:0,template:function(e,t){1&e&&r.Qb(0,"app-generic-redirect")},directives:[o.a],styles:[""]}),e})();var u=i("XZLj"),h=i("lwwr"),m=i("xoJQ"),p=i("pJFc"),b=i("ke9K"),d=i("q6bj"),g=i("NNuM"),f=i("lu7F"),y=i("81ol"),v=i("HM3f"),C=i("2kYt"),S=i("tQqY"),x=i("Ptrw"),k=i("Pq5H"),P=i("i0Si"),I=i("/Epb"),U=i("A/CR"),Q=i("LYig"),w=i("Meci"),N=i("+Tre");function R(e,t){1&e&&(r.Vb(0,"h4"),r.Gc(1,"Remember my consent for updated details"),r.Ub())}function O(e,t){1&e&&(r.Vb(0,"h4"),r.Gc(1,"Remember my consent"),r.Ub())}let T=(()=>{class e{constructor(){this.checkBoxChange=new r.o}ngOnInit(){}onCheckBoxChange(e){this.checkBoxChange.emit(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Jb({type:e,selectors:[["exchange-remember-consent"]],inputs:{returningUser:"returningUser",rpName:"rpName",idpName:"idpName",checkBoxState:"checkBoxState"},outputs:{checkBoxChange:"checkBoxChange"},decls:15,vars:5,consts:[[1,"card-container"],[1,"mt-5","card-callout","card-callout-info","mb-3","move-left","three",2,"padding-bottom","24px"],[4,"ngIf"],[1,"mb-0"],["id","remember-consent-checkbox",1,"mat-checkbox-layout",3,"checked","change"],["checkbox",""]],template:function(e,t){if(1&e){const e=r.Wb();r.Vb(0,"div",0),r.Vb(1,"mat-card",1),r.Ec(2,R,2,0,"h4",2),r.Ec(3,O,2,0,"h4",2),r.Vb(4,"p",3),r.Gc(5," Do you want us to remember your consent to share these details from "),r.Vb(6,"strong"),r.Gc(7),r.Ub(),r.Gc(8," with "),r.Vb(9,"strong"),r.Gc(10),r.Ub(),r.Gc(11,"? "),r.Ub(),r.Vb(12,"mat-checkbox",4,5),r.dc("change",(function(){r.xc(e);const i=r.vc(13);return t.onCheckBoxChange(i.checked)})),r.Gc(14," Yes, and don't ask me again. "),r.Ub(),r.Ub(),r.Ub()}2&e&&(r.Cb(2),r.mc("ngIf",t.returningUser),r.Cb(1),r.mc("ngIf",!t.returningUser),r.Cb(4),r.Hc(t.idpName),r.Cb(3),r.Hc(t.rpName),r.Cb(2),r.mc("checked",t.checkBoxState))},directives:[w.a,C.k,N.a],styles:[".card-callout-info[_ngcontent-%COMP%]{border-left:4px solid #2d486f}.card-container[_ngcontent-%COMP%]{margin:48px 0 16px}.card-callout[_ngcontent-%COMP%]{background-color:#e7eff4;border-radius:4px;padding:15px;position:relative;z-index:10}.mb-3[_ngcontent-%COMP%], .my-3[_ngcontent-%COMP%]{margin-bottom:1rem!important}.move-up[_ngcontent-%COMP%]{opacity:0;-webkit-animation:moveUp ease-in 1;animation:moveUp ease-in 1;-webkit-animation-duration:.5s;animation-duration:.5s;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.mat-checkbox-input[_ngcontent-%COMP%]{border:2px solid #333;margin-right:15px}.mat-checkbox-background[_ngcontent-%COMP%]{background-color:#333}h4[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem;font-weight:700}p[_ngcontent-%COMP%]{font-size:18px}.mat-checkbox-label[_ngcontent-%COMP%], .mat-checkbox-layout[_ngcontent-%COMP%]{font-size:18px;padding-top:3px}"]}),e})();function A(e,t){if(1&e&&(r.Vb(0,"div"),r.Qb(1,"fa-icon",13),r.Vb(2,"a",14),r.Gc(3," Back"),r.Ub(),r.Ub()),2&e){const e=r.hc();r.Cb(1),r.mc("icon",e.faAngleLeft)}}function B(e,t){if(1&e&&(r.Vb(0,"p"),r.Gc(1," Some of your details may have changed, or "),r.Vb(2,"strong"),r.Gc(3),r.Ub(),r.Gc(4," may be asking for new details. We've marked these details as "),r.Vb(5,"strong"),r.Gc(6,"Updated"),r.Ub(),r.Gc(7,". "),r.Ub()),2&e){const e=r.hc();r.Cb(3),r.Hc(e.rpName)}}function j(e,t){if(1&e&&r.Qb(0,"exchange-info-bar",15),2&e){const e=r.hc();r.mc("content",e.myGovInfoBarContent)("imgUrl",e.infoBarIcon)}}function G(e,t){if(1&e&&r.Qb(0,"exchange-consent-idp-info",16),2&e){const e=r.hc();r.mc("idpLogoUrl",e.idp.properties.logoUrl)("idpName",e.idp.properties.displayName)("infoProviderType",e.identityInfoType)}}function M(e,t){if(1&e&&r.Qb(0,"exchange-claim-container",17),2&e){const e=r.hc();r.mc("claims",e.allClaims.claims)("documentClaims",e.allClaims.documentClaims)("consentStatus",e.allClaims.consentStatus)}}function V(e,t){if(1&e&&r.Qb(0,"exchange-consent-idp-info",18),2&e){const e=r.hc();r.mc("idpName",e.apDetails.name)("infoProviderType",e.businessInfoType)}}function D(e,t){if(1&e){const e=r.Wb();r.Vb(0,"p",23),r.Vb(1,"a",24),r.dc("click",(function(){return r.xc(e),r.hc(2).changeBusiness()})),r.Qb(2,"fa-icon",13),r.Gc(3," Change Business "),r.Ub(),r.Ub()}if(2&e){const e=r.hc(2);r.Cb(2),r.mc("icon",e.faChevronLeft)}}function E(e,t){if(1&e&&(r.Vb(0,"div",19),r.Qb(1,"exchange-abn-display",20),r.Vb(2,"p",21),r.Gc(3," Business roles and permissions may be shared. "),r.Ub(),r.Ec(4,D,4,1,"p",22),r.Ub()),2&e){const e=r.hc();r.Cb(1),r.mc("selectedAbn",e.allClaims.business),r.Cb(3),r.mc("ngIf",e.totalAbns>1)}}function _(e,t){if(1&e){const e=r.Wb();r.Vb(0,"exchange-remember-consent",25),r.dc("checkBoxChange",(function(t){return r.xc(e),r.hc().rememberIdAttrSelection(t)})),r.Ub()}if(2&e){const e=r.hc();r.mc("returningUser",e.returningUser)("rpName",e.rpName)("idpName",e.idp.properties.displayName)("checkBoxState",e.isRememberIdSelected())}}let L=(()=>{class e{constructor(e,t,i,n,s,c,a,r,o,l,u,h,m,b,d,g){this.redirectService=e,this.rpQuery=t,this.apQuery=i,this.idpQuery=n,this.flowService=s,this.rpService=c,this.navigation=a,this.claimQuery=r,this.config=o,this.router=l,this.backService=u,this.timeoutQuery=h,this.timeoutStateService=m,this.helpService=b,this.flowStateQuery=d,this.pageTitleService=g,this.faChevronLeft=f.d,this.infoBarIcon="/assets/img/info-icon.svg",this.cancelContext=p.d.AuthenticationCancelled,this.faAngleLeft=f.a,this.businessInfoType="Business",this.identityInfoType="Identity"}generateStatefulTimeout(){Object(v.a)([this.timeoutQuery.activityExpiry,this.timeoutQuery.activityWarning]).subscribe(([e,t])=>{if(e&&t){const i=new Date(Date.now()+this.config.sensitiveIdleTimeoutInMilliseconds),n=new Date(Date.now()+this.config.sensitiveIdleWarningInMilliseconds);n.getTime()>new Date(t).getTime()&&i.getTime()>new Date(e).getTime()||(this.timeoutStateService.startSensitiveTimer(i),this.timeoutStateService.startSensitiveWarningTimer(n))}})}ngOnInit(){this.generateStatefulTimeout(),this.backService.setBackLocation(d.a.ProvideConsent),this.redirectService.setRedirecting(!1),this.pageTitleService.setTitle("Your consent"),this.allClaims=Object.assign({},this.claimQuery.allRpClaims),this.apDetails=Object.assign({},this.apQuery.providerDetails),this.idp=this.idpQuery.getActive(),this.totalAbns=this.apQuery.getCount(),this.rpName=this.rpQuery.displayName,this.isConnector=this.flowStateQuery.isInIntegrationFlow,this.returningUser="UPDATED"===this.allClaims.consentStatus||"CURRENT"===this.allClaims.consentStatus,null!=this.allClaims.userAttributes&&this.allClaims.userAttributes.forEach(e=>{"mygov_link_id"===e.name&&(this.isMyGovInfoBarDisplayed=!0)}),this.myGovInfoBarContent=`We'll let ${this.rpName} know your myGov account is linked.`}rememberIdAttrSelection(e){this.rpService.updateRememberConsentCheckboxStatus(e)}isRememberIdSelected(){return this.rpQuery.rememberConsentCheckbox}submitConsent(){this.flowService.updateRp("consent",p.k.Completed),this.navigation.resolveNavigation(d.a.ProvideConsent)}changeBusiness(){this.router.navigate(["/choose-business"])}ngOnDestroy(){this.timeoutStateService.resetSensitiveTimeouts()}openHelp(e){this.helpService.emitOpenHelp(e)}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(h.RedirectService),r.Pb(b.k),r.Pb(b.a),r.Pb(b.g),r.Pb(d.f),r.Pb(b.l),r.Pb(d.e),r.Pb(b.c),r.Pb(y.b),r.Pb(c.e),r.Pb(u.a),r.Pb(m.b),r.Pb(m.c),r.Pb(g.b),r.Pb(d.i),r.Pb(u.c))},e.\u0275cmp=r.Jb({type:e,selectors:[["exchange-consent-relying-party-give-consent"]],decls:27,vars:11,consts:[[4,"ngIf"],[3,"content","imgUrl",4,"ngIf"],[1,"move-left","two"],[3,"idpLogoUrl","idpName","infoProviderType",4,"ngIf"],[3,"claims","documentClaims","consentStatus",4,"ngIf"],[3,"idpName","infoProviderType",4,"ngIf"],["class","move-left three",4,"ngIf"],[3,"returningUser","rpName","idpName","checkBoxState","checkBoxChange",4,"ngIf"],[1,"move-left","four",2,"margin-top","48px"],["link","",3,"click"],[1,"addbottom-margin","move-left","four"],[1,"move-left","four"],[3,"consentContext","cancelContext","beginSubmission"],[3,"icon"],["link","","routerLink","/connector/rp-consent"],[3,"content","imgUrl"],[3,"idpLogoUrl","idpName","infoProviderType"],[3,"claims","documentClaims","consentStatus"],[3,"idpName","infoProviderType"],[1,"move-left","three"],[3,"selectedAbn"],[1,"user-info_note"],["style","margin-top: -10px;",4,"ngIf"],[2,"margin-top","-10px"],["link","","data-auto","share-rp-change-business-link","role","button",2,"vertical-align","unset",3,"click"],[3,"returningUser","rpName","idpName","checkBoxState","checkBoxChange"]],template:function(e,t){1&e&&(r.Vb(0,"div"),r.Ec(1,A,4,1,"div",0),r.Vb(2,"h1"),r.Gc(3,"Your consent"),r.Ub(),r.Vb(4,"p"),r.Gc(5,"If you give consent, we'll share these details with "),r.Vb(6,"strong"),r.Gc(7),r.Ub(),r.Gc(8,"."),r.Ub(),r.Ec(9,B,8,1,"p",0),r.Ub(),r.Ec(10,j,1,2,"exchange-info-bar",1),r.Vb(11,"div",2),r.Ec(12,G,1,3,"exchange-consent-idp-info",3),r.Ec(13,M,1,3,"exchange-claim-container",4),r.Ec(14,V,1,2,"exchange-consent-idp-info",5),r.Ub(),r.Ec(15,E,5,2,"div",6),r.Ec(16,_,1,4,"exchange-remember-consent",7),r.Vb(17,"p",8),r.Gc(18," Find out more about "),r.Vb(19,"a",9),r.dc("click",(function(){return t.openHelp("consent")})),r.Gc(20," giving consent "),r.Ub(),r.Ub(),r.Vb(21,"p",10),r.Gc(22," By giving consent, you agree to our "),r.Vb(23,"a",9),r.dc("click",(function(){return t.openHelp("privacy")})),r.Gc(24,"privacy policy "),r.Ub(),r.Ub(),r.Vb(25,"div",11),r.Vb(26,"app-buttons-new",12),r.dc("beginSubmission",(function(){return t.submitConsent()})),r.Ub(),r.Ub()),2&e&&(r.Cb(1),r.mc("ngIf",t.isConnector),r.Cb(6),r.Hc(t.rpName),r.Cb(2),r.mc("ngIf","UPDATED"===t.allClaims.consentStatus),r.Cb(1),r.mc("ngIf",t.isMyGovInfoBarDisplayed),r.Cb(2),r.mc("ngIf",t.idp&&t.allClaims.claims&&t.allClaims.claims.length>0||t.idp&&t.allClaims.documentClaims&&t.allClaims.documentClaims.length>0),r.Cb(1),r.mc("ngIf",t.allClaims.claims&&t.allClaims.claims.length>0||t.allClaims.documentClaims&&t.allClaims.documentClaims.length>0),r.Cb(1),r.mc("ngIf",t.apDetails&&t.allClaims.business),r.Cb(1),r.mc("ngIf",t.allClaims.business),r.Cb(1),r.mc("ngIf","CURRENT"!=t.allClaims.consentStatus),r.Cb(10),r.mc("consentContext","relyingparty")("cancelContext",t.cancelContext))},directives:[C.k,S.a,x.a,k.a,c.f,P.a,I.a,U.a,Q.a,T],styles:[""]}),e})();var H=i("XzLU"),J=i("cJ9h"),Z=i("5uDM"),q=i("8lHc"),W=i("vIZi"),Y=i("AytR");let F=(()=>{class e{constructor(e,t,i,n,s,c,a){this.document=e,this.exchangeApi=t,this.isamAuthApi=i,this.rpQuery=n,this.configQuery=s,this.idpQuery=c,this.apQuery=a}ngOnInit(){this.rpName=this.rpQuery.displayName,this.apAuthId=this.apQuery.apAuthId,this.returnToRelyingParty().subscribe(e=>{Object(H.k)({exclude:["persisted authorisation"]}),e&&this.externalRedirect(e.location)})}externalRedirect(e){console.debug("relying party consent return externalRedirect timeout",this.configQuery.redirectTimeout),Object(q.a)(this.configQuery.redirectTimeout).subscribe(()=>{Object(H.k)({exclude:["persisted authorisation"]}),Y.a.production||(console.warn("Redirecting via JSON object"),this.document.location.href=e)})}returnToRelyingParty(){return Object(q.a)(this.configQuery.redirectTimeout).pipe(Object(J.a)(()=>this.stepOne()),Object(Z.a)(()=>this.stepTwo()),Object(Z.a)(()=>this.stepThree()))}stepOne(){const e={id:this.idpQuery.authId,storeConsent:!!this.rpQuery.rememberConsentCheckbox,apAuthId:this.rpQuery.hasScope("tdif_business_authorisations")?this.apAuthId:null};return this.exchangeApi.storeRelyingPartyConsent(this.rpQuery.authId,e)}stepTwo(){return this.exchangeApi.confirmRelyingPartyConsentStore(this.rpQuery.authId)}stepThree(){return this.isamAuthApi.confirmRedirectDestination(this.rpQuery.requestAsString)}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(C.d),r.Pb(W.a),r.Pb(W.e),r.Pb(b.k),r.Pb(y.b),r.Pb(b.g),r.Pb(b.a))},e.\u0275cmp=r.Jb({type:e,selectors:[["exchange-consent-relying-party-return"]],decls:1,vars:1,consts:[[3,"name"]],template:function(e,t){1&e&&r.Qb(0,"app-generic-redirect",0),2&e&&r.mc("name",t.rpName)},directives:[o.a],styles:[""]}),e})();var z=i("ROBh"),X=i("8j5Y");let $=(()=>{class e{constructor(e,t,i,n,s,c,a,r,o){this.api=e,this.claimStateService=t,this.claimQuery=i,this.rpQuery=n,this.idpQuery=s,this.flowService=c,this.consentNavigation=a,this.apQuery=r,this.apStateService=o}resolve(){return this.initiateRegularUserConsentFlow()}initiateRegularUserConsentFlow(){return this.getUserInfo().pipe(Object(Z.a)(()=>this.rpQuery.hasScope("tdif_business_authorisations")?this.getBusinessInfo():Object(z.a)(null)),Object(Z.a)(()=>this.rpQuery.hasScope("tdif_business_authorisations")&&!this.apQuery.providerName?this.api.getAttributeProviderDisplayName("tdif_business_authorisations").pipe(Object(X.a)(e=>{this.apStateService.setAttributeProviderName(e.name)})):Object(z.a)(null)),Object(Z.a)(()=>this.checkClaims()),Object(X.a)(()=>{this.navigate(d.a.InitiateConsent)}))}getUserInfo(){return this.api.getRelyingPartyUserClaims(this.rpQuery.authId,this.idpQuery.authId).pipe(Object(X.a)(e=>{const{claims:t,documentClaims:i,consentStatus:n,attributes:s}=e;this.claimStateService.updateRpClaims(t),this.claimStateService.updateRpDocuments(i),this.claimStateService.updateRpConsentStatus(n),this.claimStateService.updateRpUserAttributes(s)}))}getBusinessInfo(){return this.api.getAttributeProviderBusinessClaims(this.rpQuery.authId,this.apQuery.apAuthId).pipe(Object(X.a)(e=>{this.claimStateService.updateRpBusinessSelection(e)}))}checkClaims(){return"NEW"===this.claimQuery.rpConsentStatus||"UPDATED"===this.claimQuery.rpConsentStatus?this.claimQuery.hasConsentableRpClaims||this.claimQuery.isMyGovLinked?(this.flowService.updateRp("consent",p.k.Required),Object(z.a)(!0)):(this.flowService.updateRp("consent",p.k.NotRequired),Object(z.a)(!1)):this.claimQuery.isMyGovLinked||this.isBusinessSelected()?(this.flowService.updateRp("consent",p.k.Required),Object(z.a)(!0)):(this.flowService.updateRp("consent",p.k.NotRequired),Object(z.a)(!1))}navigate(e){this.consentNavigation.resolveNavigation(e)}isBusinessSelected(){let e=!1;return this.apQuery.hasActive()&&(e=!0),e}}return e.\u0275fac=function(t){return new(t||e)(r.Zb(W.a),r.Zb(b.d),r.Zb(b.c),r.Zb(b.k),r.Zb(b.g),r.Zb(d.f),r.Zb(d.e),r.Zb(b.a),r.Zb(b.b))},e.\u0275prov=r.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const K=[{path:"",component:l,resolve:{entry:$},pathMatch:"full"},{path:"submit",component:L,canActivate:[a.e],pathMatch:"full"},{path:"return",component:F,canActivate:[a.e],pathMatch:"full"},{path:"cancel",component:(()=>{class e{constructor(e,t,i,n,s){this.document=e,this.route=t,this.config=i,this.rpQuery=n,this.title=s,this.redirectName=this.rpQuery.displayName,this.route.queryParams.subscribe(e=>{this.title.setTitle(`Returning to ${this.redirectName}`),this.externalRedirect(this.generateCancelUrl(e.context).href)})}externalRedirect(e){Object(q.a)(this.config.redirectTimeout).subscribe(()=>{Object(H.k)({exclude:["persisted authorisation"]}),this.document.location.href=e})}generateCancelUrl(e){const t=new URL(this.rpQuery.redirectUri);return t.searchParams.append("error",e),t.searchParams.append("state",this.rpQuery.state),t}}return e.\u0275fac=function(t){return new(t||e)(r.Pb(C.d),r.Pb(c.a),r.Pb(y.b),r.Pb(b.k),r.Pb(u.c))},e.\u0275cmp=r.Jb({type:e,selectors:[["exchange-rp-consent-cancel"]],decls:1,vars:1,consts:[[3,"name"]],template:function(e,t){1&e&&r.Qb(0,"app-generic-redirect",0),2&e&&r.mc("name",t.redirectName)},directives:[o.a],styles:[""]}),e})(),pathMatch:"full"}];let ee=(()=>{class e{}return e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({factory:function(t){return new(t||e)},imports:[[c.g.forChild(K)],c.g]}),e})(),te=(()=>{class e{}return e.\u0275mod=r.Nb({type:e}),e.\u0275inj=r.Mb({factory:function(t){return new(t||e)},providers:[$],imports:[[s.a,n.a,ee]]}),e})()}}]);